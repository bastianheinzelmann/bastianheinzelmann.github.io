---
layout: post
title: "Endless 2D-Maps with WFC: Part 1"
date: 2021-1-21
description: This is just a random test post
tags: 
 - WFC
 - Wave Function Collapse
 - Unity
 - 2D
 - Procedural Generation
share: true
commentsId: '1'
---

# 1. Get Wave Function Collapse to run

In my first blog post I will show my implementation of Maxim Gumin's Wave Function Collapse algorithm, short WFC. WFC derives rules from an existing tilemap and generates a new tilemap based on them. It is a pretty neat algorithm and I will try to generate endless worlds with it.

So I decided to go with Unity for this project, simply because it has the best support for 2D-Games. It also has it's own tilemap class, which I am not entirely sure is worth using, though. 

### Goals

The goal for this post is to create script, that will derive rules from a tilemap a human made and save them in a smart way. Then we will look how to implement the actual algorithm. 

### Let's make some rules

One of the advantages of WFC is, that we can create our own little tilemap and the algorithm will create something similar, so we can influence the outcome to a certain degree. But that means we have more work to do and let the user create a tilemap from which a script needs to derive rules. In this case I decided to write a C# editor script, that generates rules from a selected ```Tilemap```  and stores them in a ```Scriptable Object```. 

Rules have the form: <cite> (tile1, tile2, direction), which means "tile1" can be placed "direction" to "tile2".</cite> 

I store rules in a large boolean array with the size *numberOfTiles * numberOfTiles * directions*. This represents each possible rule and makes it possible to set and lookup rules in O(1). Like I mentioned before I store all relevant data for WFC in a ```Scriptable Object```, that looks as follows: 

```csharp
public class WFCRulesDataSO : ScriptableObject
{
    public bool[] Rules;
    public List<TileBase> TileAssets;
    public int NumTiles;
    public int[] Frequencies;
}
```

This is all the information our algorithm needs. ```TileAssets``` is an array of TileBases, which are generated by Unity from a tilesheet sprite. That is why scriptable objects are great. I can store references to assets in them. We will use them later to actual populate the tilemap. ```NumTiles``` is just the total number of different tiles, the source tilemap contains and ```Frequencies``` holds the number of appearances for each tile. 

<!-- ![image tooltip](/assets/images/rulesSO.png) -->
<p align="center"><img src="/assets/images/rulesSO.png" alt="An example for a generated scriptable object" width="80%"/></p>

